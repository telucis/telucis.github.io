(function(a,b){"use strict";var c=a.document,d=a.setTimeout||d,e=a.clearTimeout||e,f=a.setInterval||f,g=a.History=a.History||{};if(typeof g.initHtml4!=="undefined"){throw new Error("History.js HTML4 Support has already been loaded...")}g.initHtml4=function(){if(typeof g.initHtml4.initialized!=="undefined"){return false}else{g.initHtml4.initialized=true}g.enabled=true;g.savedHashes=[];g.isLastHash=function(a){var b=g.getHashByIndex(),c;c=a===b;return c};g.saveHash=function(a){if(g.isLastHash(a)){return false}g.savedHashes.push(a);return true};g.getHashByIndex=function(a){var b=null;if(typeof a==="undefined"){b=g.savedHashes[g.savedHashes.length-1]}else if(a<0){b=g.savedHashes[g.savedHashes.length+a]}else{b=g.savedHashes[a]}return b};g.discardedHashes={};g.discardedStates={};g.discardState=function(a,b,c){var d=g.getHashByState(a),e;e={discardedState:a,backState:c,forwardState:b};g.discardedStates[d]=e;return true};g.discardHash=function(a,b,c){var d={discardedHash:a,backState:c,forwardState:b};g.discardedHashes[a]=d;return true};g.discardedState=function(a){var b=g.getHashByState(a),c;c=g.discardedStates[b]||false;return c};g.discardedHash=function(a){var b=g.discardedHashes[a]||false;return b};g.recycleState=function(a){var b=g.getHashByState(a);if(g.discardedState(a)){delete g.discardedStates[b]}return true};if(g.emulated.hashChange){g.hashChangeInit=function(){g.checkerFunction=null;var b="",d,e,h,i;if(g.isInternetExplorer()){d="historyjs-iframe";e=c.createElement("iframe");e.setAttribute("id",d);e.style.display="none";c.body.appendChild(e);e.contentWindow.document.open();e.contentWindow.document.close();h="";i=false;g.checkerFunction=function(){if(i){return false}i=true;var c=g.getHash(),d=g.getHash(e.contentWindow.document.location);if(c!==b){b=c;if(d!==c){h=d=c;e.contentWindow.document.open();e.contentWindow.document.close();e.contentWindow.document.location.hash=g.escapeHash(c)}g.Adapter.trigger(a,"hashchange")}else if(d!==h){h=d;g.setHash(d,false)}i=false;return true}}else{g.checkerFunction=function(){var c=g.getHash();if(c!==b){b=c;g.Adapter.trigger(a,"hashchange")}return true}}g.intervalList.push(f(g.checkerFunction,g.options.hashChangeInterval));return true};g.Adapter.onDomLoad(g.hashChangeInit)}if(g.emulated.pushState){g.onHashChange=function(b){var c=b&&b.newURL||g.getLocationHref(),d=g.getHashByUrl(c),e=null,f=null,h=null,i;if(g.isLastHash(d)){g.busy(false);return false}g.doubleCheckComplete();g.saveHash(d);if(d&&g.isTraditionalAnchor(d)){g.Adapter.trigger(a,"anchorchange");g.busy(false);return false}e=g.extractState(g.getFullUrl(d||g.getLocationHref(),false),true);if(g.isLastSavedState(e)){g.busy(false);return false}f=g.getHashByState(e);i=g.discardedState(e);if(i){if(g.getHashByIndex(-2)===g.getHashByState(i.forwardState)){g.back(false)}else{g.forward(false)}return false}g.pushState(e.data,e.title,encodeURI(e.url),false);return true};g.Adapter.bind(a,"hashchange",g.onHashChange);g.pushState=function(b,c,d,e){d=encodeURI(d).replace(/%25/g,"%");if(g.getHashByUrl(d)){throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).")}if(e!==false&&g.busy()){g.pushQueue({scope:g,callback:g.pushState,args:arguments,queue:e});return false}g.busy(true);var f=g.createStateObject(b,c,d),h=g.getHashByState(f),i=g.getState(false),j=g.getHashByState(i),k=g.getHash();g.storeState(f);g.expectedStateId=f.id;g.recycleState(f);g.setTitle(f);if(h===j){g.busy(false);return false}if(h!==k&&h!==g.getShortUrl(g.getLocationHref())){g.setHash(h,false);return false}g.saveState(f);g.Adapter.trigger(a,"statechange");g.busy(false);return true};g.replaceState=function(a,b,c,d){c=encodeURI(c).replace(/%25/g,"%");if(g.getHashByUrl(c)){throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).")}if(d!==false&&g.busy()){g.pushQueue({scope:g,callback:g.replaceState,args:arguments,queue:d});return false}g.busy(true);var e=g.createStateObject(a,b,c),f=g.getState(false),h=g.getStateByIndex(-2);g.discardState(f,e,h);g.pushState(e.data,e.title,e.url,false);return true}}if(g.emulated.pushState){if(g.getHash()&&!g.emulated.hashChange){g.Adapter.onDomLoad(function(){g.Adapter.trigger(a,"hashchange")})}}};if(typeof g.init!=="undefined"){g.init()}})(window)